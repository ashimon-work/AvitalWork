# Use the default server block for the main storefront domain
    server {
        listen 80;
        server_name localhost smartyapp.co.il; # Production domain

        # Proxy requests to the Angular development server
        location / {
            proxy_pass http://frontend:4200; # Proxy to the Angular dev server service
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Reverse proxy for API requests
        location /api/ {
            # Use Docker's internal DNS resolver
            resolver 127.0.0.11 valid=10s;
            set $upstream_api api; # Use a variable to allow resolver
            proxy_pass http://$upstream_api:3000; # Forward to the 'api' service on port 3000 (NO TRAILING SLASH)
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # WebSocket proxying
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";

            # Optional: Increase timeouts if needed
            # proxy_connect_timeout       600;
            # proxy_send_timeout          600;
            # proxy_read_timeout          600;
            # send_timeout                600;
        }

        # Optional: Add error pages if needed
        # error_page 500 502 503 504 /50x.html;
        # location = /50x.html {
        #     root /usr/share/nginx/html;
        # }
    }

    # Server block for the Store Management subdomain
    server {
        listen 80;
        server_name manager.localhost manager.smartyapp.co.il; # Production subdomain

        # Proxy requests to the Angular development server
        location / {
            proxy_pass http://store-management-frontend-dev:4200; # Proxy to the Angular dev server service
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
# API requests from the management site will also go to the /api/ location
location /api/ {
    # Use Docker's internal DNS resolver
    resolver 127.0.0.11 valid=10s;
    set $upstream_api api; # Use a variable to allow resolver
    proxy_pass http://$upstream_api:3000; # Forward to the 'api' service on port 3000 (NO TRAILING SLASH)
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket proxying
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    # Optional: Increase timeouts if needed
    # proxy_connect_timeout       600;
    # proxy_send_timeout          600;
    # proxy_read_timeout          600;
    # send_timeout                600;
}
# This is handled by the main server block or can be duplicated here if needed.
# For simplicity, assuming API calls go to the main domain or are routed externally.
# If API calls originate from the manager subdomain, you might need a similar /api/ location here
# or ensure your API service handles CORS for the manager subdomain.
}