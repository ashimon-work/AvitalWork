<div class="product-page-container" *ngIf="product$ | async as product; else loadingProduct">
  <main class="py-12">
    <div class="container mx-auto px-6">
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16">
        
        <div class="space-y-4">
          <div class="aspect-square bg-muted overflow-hidden relative group rounded-xl" style="background-color: #f3f4f6; border-radius: 0.75rem;">
            <img
              [src]="getImageUrl(selectedImageIndex)"
              [alt]="product.name"
              class="w-full h-full object-cover"
              (error)="onImageError($event)"
            />

            <button
              *ngIf="product.imageUrls.length > 1"
              (click)="handlePrevImage()"
              class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 hover:bg-white rounded-full flex items-center justify-center transition-all shadow-sm"
              style="border-radius: 9999px; position: absolute; top: 50%; transform: translateY(-50%); left: 1rem;"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button
              *ngIf="product.imageUrls.length > 1"
              (click)="handleNextImage()"
              class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 hover:bg-white rounded-full flex items-center justify-center transition-all shadow-sm"
              style="border-radius: 9999px; position: absolute; top: 50%; transform: translateY(-50%); right: 1rem;"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>

          <div *ngIf="product.imageUrls.length > 1" class="flex gap-3">
            <button
              *ngFor="let image of product.imageUrls; let index = index"
              (click)="setSelectedImageIndex(index)"
              class="w-20 h-20 overflow-hidden border-2 transition-colors rounded-md"
              [style.border-color]="selectedImageIndex === index ? '#000' : 'transparent'"
              style="width: 5rem; height: 5rem; border-width: 2px;"
            >
              <img [src]="getImageUrl(index)" [alt]="'View ' + (index + 1)" class="w-full h-full object-cover" (error)="onImageError($event)" />
            </button>
          </div>
        </div>

        <div class="space-y-6">
          <nav class="flex items-center gap-3 text-sm" style="color: #9ca3af; display: flex; align-items: center; gap: 0.75rem; font-size: 0.875rem;">
            <a [routerLink]="['../../']" class="hover:text-black transition-colors">Home</a>
            <span>/</span>
            <a [routerLink]="['../../products']" class="hover:text-black transition-colors">Collections</a>
            <span>/</span>
            <span style="color: #000;">{{ product.name }}</span>
          </nav>

          <h1 style="font-family: 'Playfair Display', serif; font-size: 2.25rem; font-weight: 300; line-height: 1.2; color: #111827;">
            {{ product.name }}
          </h1>

          <div class="flex items-baseline gap-3">
            <span style="font-size: 1.5rem; font-weight: 600;">
              {{ currentPrice | currency }}
            </span>
          </div>

          <p style="font-size: 0.875rem; color: #6b7280; font-style: italic;">
            You can return it within 5 business days. For more details, refer to the
            <a [routerLink]="['../../returns']" style="font-weight: 600; text-decoration: underline; color: #000;">
              return policy page
            </a>.
          </p>

          <div style="color: #4b5563; line-height: 1.6;">
            <p class="whitespace-pre-line">{{ displayedDescription }}</p>
            <button
              *ngIf="isLongDescription"
              (click)="toggleDescription()"
              style="color: #000; text-decoration: underline; margin-top: 0.5rem; background: none; border: none; cursor: pointer; font-weight: 500;"
            >
              {{ showFullDescription ? "Show less" : "Show more" }}
            </button>
          </div>

          <div style="border: 1px solid #e5e7eb; padding: 1.5rem; margin-top: 1.5rem;">
            <p style="font-size: 0.75rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.25rem;">Price</p>
            <p style="font-size: 1.875rem; font-weight: 600; color: #000;">
              {{ currentPrice | currency }}
            </p>
          </div>

          <button 
            style="width: 100%; background-color: #000; color: #fff; padding: 1.25rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em; border-radius: 9999px; border: none; cursor: pointer; margin-top: 1.5rem;"
            (click)="onAddToCart(product)"
            [disabled]="(currentStock || 0) <= 0 || quantity <= 0">
            {{ tKeys.SF_PRODUCT_CARD_ADD_TO_CART_BUTTON | translate }}
          </button>
        </div>
      </div>

      <section style="margin-top: 6rem;">
        <h2 style="font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 400; margin-bottom: 2.5rem; color: #1a1a1a;">
          You may also like
        </h2>
        
        <div *ngIf="relatedProducts.length > 0">
          <div #relatedContainer class="flex gap-6 overflow-x-auto scrollbar-hide" style="scroll-behavior: smooth;">
            <app-featured-product-card
              *ngFor="let relatedProduct of relatedProducts"
              [product]="relatedProduct"
              [storeSlug]="currentStoreSlug$ | async"
              (addToCart)="onAddToCart($event)"
              class="flex-shrink-0 w-56"
            ></app-featured-product-card>
          </div>
        </div>
      </section>
    </div>
  </main>
</div>

<ng-template #loadingProduct>
  <p style="text-align: center; padding: 3rem; color: #9ca3af;">{{ tKeys.SF_PRODUCT_PAGE_LOADING_DETAILS | translate }}</p>
</ng-template>
