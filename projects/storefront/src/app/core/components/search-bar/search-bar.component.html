<!-- Overlay -->
@if (isOpen) {
  <div class="search-panel-overlay" (click)="clearSearch()"></div>
}

<!-- Panel -->
@if (isOpen) {
  <div class="search-panel">
    <div class="search-panel-content">
      <!-- Header -->
      <div class="search-panel-header">
        <h2 class="search-panel-title">{{ 'Search' }}</h2>
        <button
          class="search-panel-close-button"
          (click)="clearSearch()"
          aria-label="Close search"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Search Input -->
      <div class="search-panel-input-wrapper">
        <input
          #searchInput
          type="text"
          class="search-panel-input"
          [placeholder]="tKeys.SF_SEARCH_BAR_PLACEHOLDER | translate"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchQueryChanged($event)"
          (keydown)="handleKeyDown($event)"
          (focus)="onSearchFocus()"
          autofocus
        />
      </div>

      <!-- Results -->
      @if (searchQuery.length > 0) {
        <div class="search-panel-results">
          <!-- Products/Stores -->
          @if (currentSearchSuggestions.length > 0) {
            <div class="search-panel-section">
              <h3 class="search-panel-section-title">
                {{
                  currentSearchSuggestions[0].resultType === 'product'
                    ? 'Products'
                    : 'Stores'
                }}
              </h3>
              <div class="search-panel-products">
                @for (
                  suggestion of currentSearchSuggestions;
                  track suggestion.id
                ) {
                  <a
                    class="search-panel-product-link"
                    (click)="selectSuggestion(suggestion)"
                  >
                    <!-- Product Template -->
                    @if (suggestion.resultType === 'product') {
                      <div class="search-panel-product-image">
                        @if (
                          suggestion.imageUrls &&
                          suggestion.imageUrls.length > 0
                        ) {
                          <img
                            [src]="suggestion.imageUrls[0]"
                            [alt]="suggestion.name"
                            class="product-image"
                          />
                        } @else {
                          <div class="product-image-placeholder">
                            <span>{{ suggestion.name.charAt(0) || 'P' }}</span>
                          </div>
                        }
                      </div>
                      <div class="search-panel-product-details">
                        <p class="search-panel-product-price">
                          {{ suggestion.price | currency }}
                        </p>
                        <p class="search-panel-product-name">
                          {{ suggestion.name }}
                        </p>
                      </div>
                    }

                    <!-- Store Template -->
                    @if (suggestion.resultType === 'store') {
                      <div class="search-panel-product-image">
                        <div class="product-image-placeholder">
                          <span>{{ suggestion.name.charAt(0) || 'S' }}</span>
                        </div>
                      </div>
                      <div class="search-panel-product-details">
                        <p class="search-panel-product-name">
                          {{ suggestion.name }}
                        </p>
                        <p class="search-panel-product-description">
                          {{ suggestion.description | slice: 0 : 50
                          }}{{
                            suggestion.description &&
                            suggestion.description.length > 50
                              ? '...'
                              : ''
                          }}
                        </p>
                      </div>
                    }
                  </a>
                }
              </div>
            </div>
          }

          <!-- No results -->
          @if (currentSearchSuggestions.length === 0) {
            <p class="search-panel-no-results">
              No results found for "{{ searchQuery }}"
            </p>
          }
        </div>
      }
    </div>
  </div>
}
