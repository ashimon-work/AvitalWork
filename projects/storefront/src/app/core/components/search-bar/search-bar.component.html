<div class="search-container">
  <!-- Wrap input in a form -->
  <form (ngSubmit)="submitSearch()" class="search-form">
    <input type="text"
           placeholder="Search products..."
           class="search-input"
           [(ngModel)]="searchQuery"
           name="searchQuery"
           (input)="search(searchQuery)"
           (blur)="hideSuggestions()">
    <!-- Optional: Add a submit button if desired -->
    <!-- <button type="submit" class="search-submit-btn">Go</button> -->
  </form>
  <!-- Suggestions Dropdown -->
  <ul class="suggestions-list" *ngIf="showSuggestions && (searchResults$ | async) as results">
    <!-- Check if results exist and query is long enough before showing "No results" -->
    <li *ngIf="results.length === 0 && searchQuery.length >= 3" class="no-results">
      No results found for "{{ searchQuery }}"
    </li>
    <!-- Loop through combined results -->
    <li *ngFor="let suggestion of results" (mousedown)="selectSuggestion(suggestion)"> <!-- Use mousedown -->

      <!-- Product Suggestion Template -->
      <ng-container *ngIf="suggestion.resultType === 'product'">
        <a [routerLink]="['/', currentStoreSlug$ | async, 'product', suggestion.id]" (click)="showSuggestions = false" class="suggestion-link product-suggestion">
          <!-- Display actual image if available, otherwise omit image tag -->
          <img *ngIf="suggestion.imageUrl" [src]="suggestion.imageUrl" alt="{{ suggestion.name }}" class="suggestion-image">
          <!-- Add a placeholder text/icon if no image? For now, just omit. -->
          <div class="suggestion-details">
            <span class="suggestion-name">{{ suggestion.name }}</span>
            <span class="suggestion-price">{{ suggestion.price | currency }}</span>
          </div>
        </a>
      </ng-container>

      <!-- Store Suggestion Template -->
      <ng-container *ngIf="suggestion.resultType === 'store'">
         <a [routerLink]="['/', suggestion.slug]" (click)="showSuggestions = false" class="suggestion-link store-suggestion">
           <!-- Omit placeholder image tag as it doesn't exist -->
           <!-- <img src="/assets/images/placeholder-store.png" alt="{{ suggestion.name }}" class="suggestion-image"> -->
           <div class="suggestion-details">
             <span class="suggestion-name">{{ suggestion.name }}</span>
             <span class="suggestion-description" *ngIf="suggestion.description">{{ suggestion.description | slice:0:50 }}...</span>
           </div>
         </a>
      </ng-container>
    </li>
    <!-- Optional: Add loading indicator -->
  </ul>
</div>
