@if (isOpen) {
  <!-- Overlay -->
  <div
    class="search-panel-overlay"
    (click)="onClose()">
  </div>

  <!-- Panel -->
  <div class="search-panel">
    <div class="search-panel-content">
      <!-- Header -->
      <div class="search-panel-header">
        <h2 class="search-panel-title">{{ 'Search' }}</h2>
        <button
          class="search-panel-close-button"
          (click)="onClose()"
          aria-label="Close search">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Search Input -->
      <div class="search-panel-input-wrapper">
        <input
          #searchInput
          type="text"
          class="search-panel-input"
          [placeholder]="'Type a keyword...'"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchQueryChanged($event)"
          (keydown)="handleKeyDown($event)"
          autofocus />
      </div>

      <!-- Results -->
      @if (searchQuery.length > 0) {
        <div class="search-panel-results">
          <!-- Products -->
          @if (searchResults.length > 0) {
            <div class="search-panel-section">
              <h3 class="search-panel-section-title">
                {{ searchResults[0].resultType === 'product' ? 'Products' : 'Stores' }}
              </h3>
              <div class="search-panel-products">
                @for (result of searchResults; track result.id) {
                  <a
                    class="search-panel-product-link"
                    (click)="navigateToResult(result)">
                    <!-- Product Template -->
                    @if (result.resultType === 'product') {
                      <div class="search-panel-product-image">
                        @if (result.imageUrls && result.imageUrls.length > 0) {
                          <img
                            [src]="result.imageUrls[0]"
                            [alt]="result.name"
                            class="product-image" />
                        } @else {
                          <div class="product-image-placeholder">
                            <span>{{ result.name.charAt(0) || 'P' }}</span>
                          </div>
                        }
                      </div>
                      <div class="search-panel-product-details">
                        <p class="search-panel-product-price">{{ result.price | currency }}</p>
                        <p class="search-panel-product-name">{{ result.name }}</p>
                      </div>
                    }

                    <!-- Store Template -->
                    @if (result.resultType === 'store') {
                      <div class="search-panel-product-image">
                        <div class="product-image-placeholder">
                          <span>{{ result.name.charAt(0) || 'S' }}</span>
                        </div>
                      </div>
                      <div class="search-panel-product-details">
                        <p class="search-panel-product-name">{{ result.name }}</p>
                        <p class="search-panel-product-description">
                          {{ result.description | slice:0:50 }}{{ result.description && result.description.length > 50 ? '...' : ''}}
                        </p>
                      </div>
                    }
                  </a>
                }
              </div>
            </div>
          }

          <!-- No results -->
          @if (searchResults.length === 0) {
            <p class="search-panel-no-results">
              No results found for "{{ searchQuery }}"
            </p>
          }
        </div>
      }
    </div>
  </div>
}
