<div class="not-found-container">
  <h1>404 - Page Not Found</h1>
  <p>Oops! The page you are looking for does not exist or may have been moved.</p>

  <!-- Conditional Search Section -->
  <div class="search-section">
    <ng-container *ngIf="currentStoreSlug$ | async as slug; else storeSearchBlock">
      <!-- Product Search (within store context) -->
      <p>Try searching for products in this store:</p>
      <form (ngSubmit)="onProductSearchSubmit()" class="search-input-group">
        <input type="search"
               placeholder="Search products..."
               [(ngModel)]="productSearchInput"
               (ngModelChange)="onProductSearchInputChange($event)"
               name="productSearchInput"
               autocomplete="off">
        <button type="submit">Search Products</button>
      </form>
      <!-- Display Product Suggestions -->
      <div class="product-suggestions" *ngIf="productSuggestions$ | async as suggestions">
        <ul *ngIf="suggestions.length > 0">
          <li *ngFor="let product of suggestions" (click)="selectProductSuggestion(product)">
            {{ product.name }}
            <!-- Optionally display price or other details -->
            <span *ngIf="product.price" class="suggestion-price"> - ${{ product.price | number:'1.2-2' }}</span>
          </li>
        </ul>
        <p *ngIf="suggestions.length === 0 && productSearchInput.length >= 2" class="no-suggestions">
          No product suggestions found for "{{ productSearchInput }}".
        </p>
      </div>
    </ng-container>

    <ng-template #storeSearchBlock>
      <!-- Store Search (no store context) -->
      <p>Try searching for a store:</p>
      <form class="search-input-group"> <!-- Removed (ngSubmit) -->
        <input type="search"
               placeholder="Search stores..."
               [(ngModel)]="searchQuery"
               (ngModelChange)="onStoreSearchQueryChange($event)"
               name="searchQueryStore"
               autocomplete="off">
        <!-- Removed submit button as search is reactive -->
      </form>
      <!-- Display Store Search Results -->
      <div class="store-search-results" *ngIf="storeSearchResults$ | async as stores">
        <ul *ngIf="stores.length > 0; else noStoresFound">
          <li *ngFor="let store of stores">
            <a [routerLink]="['/', store.slug]">{{ store.name }}</a>
            <p *ngIf="store.description">{{ store.description }}</p>
          </li>
        </ul>
        <ng-template #noStoresFound>
          <p *ngIf="searchQuery.length >= 2">No stores found matching "{{ searchQuery }}".</p>
        </ng-template>
      </div>
    </ng-template>
  </div>

  <div class="navigation-links">
    <!-- Use async pipe to get the current store slug for the link -->
    <!-- Conditional Back Button -->
    <a *ngIf="currentStoreSlug$ | async as slug" [routerLink]="['/', slug]" class="btn btn-primary">Back to Store Home</a>
    <a *ngIf="!(currentStoreSlug$ | async)" routerLink="/" class="btn btn-primary">Back to Site Home</a>
    <!-- Add link to contact page or sitemap later if desired -->
  </div>

  <!-- Suggested Pages -->
  <!-- Suggested Pages (Only show if in store context) -->
  <div class="suggested-pages" *ngIf="currentStoreSlug$ | async as slug">
    <ng-container *ngIf="suggestedLinks$ | async as links">
      <ng-container *ngIf="links && links.length > 0">
        <h2>Maybe you were looking for:</h2>
        <ul>
          <li *ngFor="let link of links">
            <!-- Assuming link.path is relative to the store slug -->
            <a [routerLink]="['/', slug, link.path]">{{ link.name }}</a>
          </li>
        </ul>
      </ng-container>
    </ng-container>
  </div>

  <!-- Optional: Add an image or animation -->
  <!-- <img src="/assets/images/404-image.svg" alt="Page not found illustration"> -->

</div>