<section class="account-orders-section" aria-label="Order history">
  <!-- Header -->
  <header class="section-header">
    <div class="header-title-container">
      <mat-icon>{{ getIcon('Package') }}</mat-icon>
      <h1>{{ tKeys.SF_ACCOUNT_DETAILS_ORDER_HISTORY_TITLE | translate }}</h1>
    </div>
    <p class="muted-text">{{ tKeys.SF_ACCOUNT_ORDER_MANGMENT_ORDERS | translate }}</p>
  </header>

  <!-- Orders Table Card -->
  <mat-card class="orders-table-card" *ngIf="orders && orders.length > 0; else noOrders">
    <mat-card-header>
      <mat-card-title>{{ tKeys.SF_ACCOUNT_ALL_ORDERS | translate }} ({{ totalOrdersCount }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="table-responsive">
        <table mat-table [dataSource]="orders" class="orders-table">
          <!-- Order # Column -->
          <ng-container matColumnDef="orderNumber">
            <th mat-header-cell *matHeaderCellDef>{{ tKeys.SF_ACCOUNT_ORDERS_TABLE_ORDER_HEADER | translate }}</th>
            <td mat-cell *matCellDef="let order" class="font-medium">{{ order.orderNumber }}</td>
          </ng-container>

          <!-- Date Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef>{{ tKeys.SF_ACCOUNT_ORDERS_TABLE_DATE_HEADER | translate }}</th>
            <td mat-cell *matCellDef="let order" class="text-muted-foreground">{{ order.createdAt | date:'MMM d, yyyy'
              }}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>{{ tKeys.SF_ACCOUNT_ORDERS_TABLE_STATUS_HEADER | translate }}</th>
            <td mat-cell *matCellDef="let order">
              <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                {{ getStatusLabel(order.status) }}
              </span>
            </td>
          </ng-container>

          <!-- Items Column -->
          <ng-container matColumnDef="items">
            <th mat-header-cell *matHeaderCellDef class="text-center">{{ tKeys.SF_ACCOUNT_ORDERS_TABLE_ITEMS | translate
              }}</th>
            <td mat-cell *matCellDef="let order" class="text-muted-foreground text-center">
              {{ getItemCount(order) }} {{ getItemCount(order) === 1 ? 'item' : 'items' }}
            </td>
          </ng-container>

          <!-- Total Column -->
          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef class="text-right">{{ tKeys.SF_ACCOUNT_ORDERS_TABLE_TOTAL_HEADER |
              translate }}</th>
            <td mat-cell *matCellDef="let order" class="font-semibold text-right">
              {{ order.totalAmount | currency:'ILS' }}
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-right actions-header">Actions</th>
            <td mat-cell *matCellDef="let order" class="text-right actions-cell">
              <button mat-button (click)="onViewOrder(order)" class="action-button view-button"
                [attr.aria-label]="'View order ' + order.orderNumber">
                <mat-icon>{{ getIcon('Eye') }}</mat-icon> View
              </button>
              <button mat-button *ngIf="order.status === 'delivered' || order.status === 'shipped'"
                (click)="onDownloadInvoice(order)" class="action-button invoice-button"
                [attr.aria-label]="'Download invoice for order ' + order.orderNumber">
                <mat-icon>{{ getIcon('Download') }}</mat-icon> Invoice
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            class="table-row hover:bg-muted/50 transition-colors"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>

  <ng-template #noOrders>
    <mat-card class="no-orders-card">
      <mat-card-content>
        <div class="no-orders-content">
          <mat-icon class="no-orders-icon">{{ tKeys.SF_ACCOUNT_NO_ORDERS_INFO_OUTLINE | translate }}</mat-icon>
          <p>{{ tKeys.SF_ACCOUNT_NO_ORDERS | translate }}</p>
          <p class="muted-text">{{tKeys.SF_ACCOUNT_NO_ORDERS_APPEAR | translate }}</p>
          <!-- Optional: Add a button to shop -->
          <!-- <button mat-flat-button color="primary" routerLink="/products">Start Shopping</button> -->
        </div>
      </mat-card-content>
    </mat-card>
  </ng-template>

  <!-- Summary Stats -->
  <div class="summary-stats-grid" *ngIf="orders && orders.length > 0">
    <mat-card class="summary-stat-card">
      <mat-card-content>
        <p class="stat-value">{{ totalOrdersCount }}</p>
        <p class="stat-label muted-text">{{ tKeys.SF_ACCOUNT_TOTAL_ORDERS | translate }}</p>
      </mat-card-content>
    </mat-card>
    <mat-card class="summary-stat-card">
      <mat-card-content>
        <p class="stat-value">{{ totalSpent | currency:'ILS' }}</p>
        <p class="stat-label muted-text">{{ tKeys.SF_ACCOUNT_TOTAL_SPENT | translate }}</p>
      </mat-card-content>
    </mat-card>
    <mat-card class="summary-stat-card">
      <mat-card-content>
        <p class="stat-value">{{ totalDeliveredOrders }}</p>
        <p class="stat-label muted-text">{{ tKeys.SF_ACCOUNT_DELIVERED | translate }}</p>
      </mat-card-content>
    </mat-card>
  </div>
</section>