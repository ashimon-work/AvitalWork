<h3>{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_TITLE | translate }}</h3>

<!-- Success/Error Messages -->
<div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

<!-- Form -->
<form [formGroup]="changePasswordForm" (ngSubmit)="saveNewPassword()" novalidate>

  <!-- Current Password -->
  <div class="form-group mb-3">
    <label for="currentPassword">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_CURRENT_LABEL | translate }}</label>
    <input type="password" id="currentPassword" formControlName="currentPassword" class="form-control"
           [ngClass]="{ 'is-invalid': currentPassword?.invalid && (currentPassword?.dirty || currentPassword?.touched) }">
    <div *ngIf="currentPassword?.invalid && (currentPassword?.dirty || currentPassword?.touched)" class="invalid-feedback">
      <div *ngIf="currentPassword?.errors?.['required']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_CURRENT_REQUIRED_ERROR | translate }}</div>
      <div *ngIf="currentPassword?.errors?.['incorrect']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_CURRENT_INCORRECT_ERROR | translate }}</div>
    </div>
  </div>

  <!-- New Password -->
  <div class="form-group mb-3">
    <label for="newPassword">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_NEW_LABEL | translate }}</label>
    <input type="password" id="newPassword" formControlName="newPassword" class="form-control"
           [ngClass]="{ 'is-invalid': newPassword?.invalid && (newPassword?.dirty || newPassword?.touched) }">
    <div *ngIf="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)" class="invalid-feedback">
      <div *ngIf="newPassword?.errors?.['required']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_NEW_REQUIRED_ERROR | translate }}</div>
      <div *ngIf="newPassword?.errors?.['minlength']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_NEW_MINLENGTH_ERROR | translate }}</div>
      <div *ngIf="newPassword?.errors?.['maxlength']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_NEW_MAXLENGTH_ERROR | translate }}</div>
      <!-- Add pattern error message if pattern validator is used -->
      <!-- <div *ngIf="newPassword?.errors?.['pattern']">Password requires uppercase, lowercase, number, and special character.</div> -->
    </div>
    <!-- Add password requirements list if desired -->
    <!-- <ul class="password-requirements"> ... </ul> -->
  </div>

  <!-- Confirm New Password -->
  <div class="form-group mb-3">
    <label for="confirmNewPassword">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_CONFIRM_LABEL | translate }}</label>
    <input type="password" id="confirmNewPassword" formControlName="confirmNewPassword" class="form-control"
           [ngClass]="{ 'is-invalid': (confirmNewPassword?.invalid || changePasswordForm.hasError('passwordMismatch')) && (confirmNewPassword?.dirty || confirmNewPassword?.touched) }">
    <div *ngIf="(confirmNewPassword?.invalid || changePasswordForm.hasError('passwordMismatch')) && (confirmNewPassword?.dirty || confirmNewPassword?.touched)" class="invalid-feedback">
      <div *ngIf="confirmNewPassword?.errors?.['required']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_CONFIRM_REQUIRED_ERROR | translate }}</div>
      <div *ngIf="changePasswordForm.hasError('passwordMismatch') && !confirmNewPassword?.errors?.['required']">{{ tKeys.SF_ACCOUNT_CHANGE_PASSWORD_MISMATCH_ERROR | translate }}</div>
    </div>
  </div>

  <div class="form-actions mt-3">
    <button type="submit" class="btn btn-primary" [disabled]="isLoading || changePasswordForm.invalid">
      {{ isLoading ? (tKeys.SF_ACCOUNT_CHANGE_PASSWORD_BUTTON_SAVING | translate) : (tKeys.SF_ACCOUNT_CHANGE_PASSWORD_BUTTON_CHANGE | translate) }}
    </button>
  </div>

</form>
