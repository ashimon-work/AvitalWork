<h3>Change Password</h3>

<!-- Success/Error Messages -->
<div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

<!-- Form -->
<form [formGroup]="changePasswordForm" (ngSubmit)="saveNewPassword()" novalidate>

  <!-- Current Password -->
  <div class="form-group mb-3">
    <label for="currentPassword">Current Password</label>
    <input type="password" id="currentPassword" formControlName="currentPassword" class="form-control"
           [ngClass]="{ 'is-invalid': currentPassword?.invalid && (currentPassword?.dirty || currentPassword?.touched) }">
    <div *ngIf="currentPassword?.invalid && (currentPassword?.dirty || currentPassword?.touched)" class="invalid-feedback">
      <div *ngIf="currentPassword?.errors?.['required']">Current password is required.</div>
      <div *ngIf="currentPassword?.errors?.['incorrect']">Incorrect current password.</div>
    </div>
  </div>

  <!-- New Password -->
  <div class="form-group mb-3">
    <label for="newPassword">New Password</label>
    <input type="password" id="newPassword" formControlName="newPassword" class="form-control"
           [ngClass]="{ 'is-invalid': newPassword?.invalid && (newPassword?.dirty || newPassword?.touched) }">
    <div *ngIf="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)" class="invalid-feedback">
      <div *ngIf="newPassword?.errors?.['required']">New password is required.</div>
      <div *ngIf="newPassword?.errors?.['minlength']">Password must be at least 8 characters long.</div>
      <div *ngIf="newPassword?.errors?.['maxlength']">Password cannot exceed 100 characters.</div>
      <!-- Add pattern error message if pattern validator is used -->
      <!-- <div *ngIf="newPassword?.errors?.['pattern']">Password requires uppercase, lowercase, number, and special character.</div> -->
    </div>
    <!-- Add password requirements list if desired -->
    <!-- <ul class="password-requirements"> ... </ul> -->
  </div>

  <!-- Confirm New Password -->
  <div class="form-group mb-3">
    <label for="confirmNewPassword">Confirm New Password</label>
    <input type="password" id="confirmNewPassword" formControlName="confirmNewPassword" class="form-control"
           [ngClass]="{ 'is-invalid': (confirmNewPassword?.invalid || changePasswordForm.hasError('passwordMismatch')) && (confirmNewPassword?.dirty || confirmNewPassword?.touched) }">
    <div *ngIf="(confirmNewPassword?.invalid || changePasswordForm.hasError('passwordMismatch')) && (confirmNewPassword?.dirty || confirmNewPassword?.touched)" class="invalid-feedback">
      <div *ngIf="confirmNewPassword?.errors?.['required']">Please confirm your new password.</div>
      <div *ngIf="changePasswordForm.hasError('passwordMismatch') && !confirmNewPassword?.errors?.['required']">Passwords do not match.</div>
    </div>
  </div>

  <div class="form-actions mt-3">
    <button type="submit" class="btn btn-primary" [disabled]="isLoading || changePasswordForm.invalid">
      {{ isLoading ? 'Saving...' : 'Change Password' }}
    </button>
  </div>

</form>
