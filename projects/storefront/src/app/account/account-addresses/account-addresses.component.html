<section class="addresses-section" [attr.aria-label]="'Manage addresses'">
  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-indicator">
    <p>{{ tKeys.SF_ACCOUNT_ADDRESSES_LOADING | translate }}</p>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="message message-success">
    <img src="assets/icons/check-circle.svg" alt="" class="message-icon">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="message message-error">
    <img src="assets/icons/x.svg" alt="" class="message-icon">
    {{ errorMessage }}
  </div>

  <!-- Header -->
  <header class="welcome-header" *ngIf="!showForm">
    <h1 class="welcome-title">{{ tKeys.SF_ACCOUNT_ADDRESSES_TITLE | translate }}</h1>
    <p class="welcome-subtitle">{{ tKeys.SF_ACCOUNT_ADDRESSES_MANAGMENT | translate }}</p>
    <button mat-raised-button color="primary" (click)="openAddForm()" class="add-address-button">
      <img src="assets/icons/plus.svg" alt="" class="button-icon">
      {{ tKeys.SF_ACCOUNT_ADDRESSES_ADD_NEW_BUTTON | translate }}
    </button>
  </header>

  <!-- Address List -->
  <div *ngIf="!showForm && (addresses$ | async) as addresses" class="addresses-content">
    <div *ngIf="addresses.length > 0; else noAddresses" class="addresses-grid">
      <mat-card *ngFor="let address of addresses" class="address-card">
        <mat-card-header>
          <mat-card-title class="address-name">{{ address.fullName }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="address-details">
            <p class="address-line">{{ address.street1 }}</p>
            <p class="address-line" *ngIf="address.street2">{{ address.street2 }}</p>
            <p class="address-line">{{ address.city }}, {{ address.postalCode }}</p>
            <p class="address-line">{{ address.country }}</p>
            <p class="address-line" *ngIf="address.phoneNumber">
              <strong>Phone:</strong> {{ address.phoneNumber }}
            </p>
          </div>

          <!-- Status Badge -->
          <div class="address-badges" *ngIf="address.isDefaultShipping">
            <span class="default-badge">
              <img src="assets/icons/check-circle.svg" alt="" class="badge-icon">
              {{ tKeys.SF_ACCOUNT_ADDRESSES_DEFAULT_ADDRESS | translate }}
            </span>
          </div>

          <mat-divider> </mat-divider>

          <!-- Actions -->
          <div class="address-actions">
            <button mat-button (click)="openEditForm(address)" class="action-button edit-button">
              <img src="assets/icons/edit.svg" alt="" class="action-icon">
              {{ tKeys.SF_ACCOUNT_ADDRESSES_EDIT_BUTTON | translate }}
            </button>

            <!-- Default Address Toggle -->
            <button mat-button (click)="toggleDefault(address.id)" [disabled]="isLoading" class="action-button"
              [ngClass]="address.isDefaultShipping ? 'default-active' : 'default-inactive'">
              <img [src]="address.isDefaultShipping ? 'assets/icons/check-circle.svg' : 'assets/icons/check.svg'" alt=""
                class="action-icon">
              {{ address.isDefaultShipping ? (tKeys.SF_ACCOUNT_REMOVE_DEFAULT_ADDRESS | translate) :
              (tKeys.SF_ACCOUNT_MAKE_DEFAULT_ADDRESS | translate) }}
            </button>

            <button mat-button (click)="deleteAddress(address.id)" [disabled]="isLoading"
              class="action-button delete-button">
              <img src="assets/icons/trash.svg" alt="" class="action-icon">
              {{ tKeys.SF_ACCOUNT_ADDRESSES_DELETE_BUTTON | translate }}
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    <ng-template #noAddresses>
      <div class="empty-state">
        <img src="assets/icons/map-pin.svg" alt="" class="empty-icon">
        <h3 class="empty-title">{{ tKeys.SF_ACCOUNT_NO_ADDRESS_FOUND | translate }}</h3>
        <p class="empty-description">{{ tKeys.SF_ACCOUNT_ADDRESSES_NO_ADDRESSES | translate }}</p>
        <button mat-raised-button color="primary" (click)="openAddForm()" class="empty-action-button">
          <img src="assets/icons/plus.svg" alt="" class="button-icon">
          {{ tKeys.SF_ACCOUNT_ADDRESSES_ADD_NEW_BUTTON | translate }}
        </button>
      </div>
    </ng-template>
  </div>

  <!-- Add/Edit Form -->
  <div *ngIf="showForm" class="form-section">
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title class="form-title">
          <img src="assets/icons/map-pin.svg" alt="" class="title-icon">
          {{ isEditing ? (tKeys.SF_ACCOUNT_ADDRESSES_EDIT_FORM_TITLE | translate) :
          (tKeys.SF_ACCOUNT_ADDRESSES_ADD_FORM_TITLE | translate) }}
        </mat-card-title>
      </mat-card-header>

      <mat-card-content class="form-content">
        <form [formGroup]="addressForm" (ngSubmit)="saveAddress()" novalidate class="address-form">
          <div class="form-row">
            <!-- Full Name -->
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_FULL_NAME_LABEL | translate }}</mat-label>
              <input matInput formControlName="fullName" autocomplete="name">
              <mat-error *ngIf="fullName?.hasError('required')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_FULL_NAME_REQUIRED_ERROR | translate }}
              </mat-error>
              <mat-error *ngIf="fullName?.hasError('maxlength')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_FULL_NAME_MAXLENGTH_ERROR | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <!-- Street Address -->
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_STREET1_LABEL | translate }}</mat-label>
              <input matInput formControlName="street1" autocomplete="address-line1">
              <mat-error *ngIf="street1?.hasError('required')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_STREET1_REQUIRED_ERROR | translate }}
              </mat-error>
              <mat-error *ngIf="street1?.hasError('maxlength')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_STREET1_MAXLENGTH_ERROR | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <!-- Apartment/Suite -->
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_STREET2_LABEL | translate }}</mat-label>
              <input matInput formControlName="street2" autocomplete="address-line2">
              <mat-error *ngIf="street2?.hasError('maxlength')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_STREET2_MAXLENGTH_ERROR | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <!-- City -->
            <mat-form-field appearance="outline" class="form-field half-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_CITY_LABEL | translate }}</mat-label>
              <input matInput formControlName="city" autocomplete="address-level2">
              <mat-error *ngIf="city?.hasError('required')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_CITY_REQUIRED_ERROR | translate }}
              </mat-error>
              <mat-error *ngIf="city?.hasError('maxlength')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_CITY_MAXLENGTH_ERROR | translate }}
              </mat-error>
            </mat-form-field>

            <!-- Postal Code -->
            <mat-form-field appearance="outline" class="form-field half-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_POSTAL_CODE_LABEL | translate }}</mat-label>
              <input matInput formControlName="postalCode" autocomplete="postal-code">
              <mat-error *ngIf="postalCode?.hasError('required')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_POSTAL_CODE_REQUIRED_ERROR | translate }}
              </mat-error>
              <mat-error *ngIf="postalCode?.hasError('maxlength')">
                {{ tKeys.SF_ACCOUNT_ADDRESSES_POSTAL_CODE_MAXLENGTH_ERROR | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <!-- Country -->
            <mat-form-field appearance="outline" class="form-field half-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_COUNTRY_LABEL | translate }}</mat-label>
              <input matInput formControlName="country" readonly>
            </mat-form-field>

            <!-- Phone Number -->
            <mat-form-field appearance="outline" class="form-field half-width">
              <mat-label>{{ tKeys.SF_ACCOUNT_ADDRESSES_PHONE_NUMBER_LABEL | translate }}</mat-label>
              <input matInput type="tel" formControlName="phoneNumber" autocomplete="tel">
            </mat-form-field>
          </div>

          <mat-divider></mat-divider>

          <!-- Form Actions -->
          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="isLoading || addressForm.invalid"
              class="save-button">
              <img src="assets/icons/check.svg" alt="" class="button-icon" *ngIf="!isLoading">
              {{ isLoading ? (tKeys.SF_ACCOUNT_ADDRESSES_SAVE_BUTTON_SAVING | translate) : (isEditing ?
              (tKeys.SF_ACCOUNT_ADDRESSES_SAVE_BUTTON_UPDATE | translate) : (tKeys.SF_ACCOUNT_ADDRESSES_SAVE_BUTTON_SAVE
              | translate)) }}
            </button>

            <button mat-button type="button" (click)="closeForm()" [disabled]="isLoading" class="cancel-button">
              {{ tKeys.SF_ACCOUNT_ADDRESSES_CANCEL_BUTTON | translate }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</section>