<section class="overview-section" [attr.aria-label]="'Account overview'">
  <div *ngIf="isLoading" class="loading-indicator">
    <p>{{ tKeys.SF_ACCOUNT_OVERVIEW_LOADING | translate }}</p>
  </div>

  <div *ngIf="accountOverview$ | async as overview; else noOverviewData" class="overview-content">
    <!-- Welcome Header -->
    <header class="welcome-header">
      <h1 class="welcome-title" *ngIf="overview.profile">
        Welcome back, {{ overview.profile.firstName }}!
      </h1>
      <p class="welcome-subtitle">
        Here's an overview of your account activity
      </p>
    </header>

    <div class="content-grid">
      <!-- Recent Orders - Takes 2 columns on large screens -->
      <div class="orders-section">
        <mat-card>
          <mat-card-header>
            <mat-card-title class="card-title-with-icon">
              <img src="assets/icons/check-circle.svg" alt="" class="title-icon">
              {{ tKeys.SF_ACCOUNT_OVERVIEW_RECENT_ORDERS_TITLE | translate }}
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="table-container" *ngIf="overview.recentOrders && overview.recentOrders.length > 0; else noRecentOrders">
              <table mat-table [dataSource]="overview.recentOrders" class="orders-table">
                <!-- Order Number Column -->
                <ng-container matColumnDef="orderNumber">
                  <th mat-header-cell *matHeaderCellDef>Order #</th>
                  <td mat-cell *matCellDef="let order" class="order-number">{{ order.orderReference }}</td>
                </ng-container>

                <!-- Date Column -->
                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef>Date</th>
                  <td mat-cell *matCellDef="let order" class="order-date">{{ order.orderDate | date:'MMM d, yyyy' }}</td>
                </ng-container>

                <!-- Status Column -->
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Status</th>
                  <td mat-cell *matCellDef="let order">
                    <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                      {{ order.status }}
                    </span>
                  </td>
                </ng-container>

                <!-- Total Column -->
                <ng-container matColumnDef="total">
                  <th mat-header-cell *matHeaderCellDef>Total</th>
                  <td mat-cell *matCellDef="let order" class="order-total">{{ order.totalAmount | currency:'ILS' }}</td>
                </ng-container>

                <!-- Action Column -->
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef class="action-header">Action</th>
                  <td mat-cell *matCellDef="let order" class="action-cell">
                    <button mat-button [routerLink]="['../orders', order.id]" class="view-button">
                      <img src="assets/icons/eye.svg" alt="" class="button-icon">
                      View
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="order-row"></tr>
              </table>
            </div>
            <ng-template #noRecentOrders>
              <p class="no-orders-message">{{ tKeys.SF_ACCOUNT_OVERVIEW_NO_RECENT_ORDERS | translate }}</p>
            </ng-template>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Right Column - Address and Profile -->
      <div class="sidebar-section">
        <!-- Default Address -->
        <mat-card class="address-card">
          <mat-card-header>
            <mat-card-title class="card-title-with-icon">
              <img src="assets/icons/map-pin.svg" alt="" class="title-icon">
              {{ tKeys.SF_ACCOUNT_OVERVIEW_DEFAULT_SHIPPING_ADDRESS_TITLE | translate }}
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="address-content">
            <div class="address-details">
              <p class="address-line" *ngIf="overview.profile">{{ overview.profile.firstName }} {{ overview.profile.lastName }}</p>
              <p class="address-line">{{ getDefaultShippingAddress(overview) }}</p>
            </div>
            <mat-divider></mat-divider>
            <button mat-stroked-button routerLink="../addresses" class="edit-address-button">
              <img src="assets/icons/edit.svg" alt="" class="button-icon">
              {{ tKeys.SF_ACCOUNT_OVERVIEW_MANAGE_ADDRESSES_BUTTON | translate }}
            </button>
          </mat-card-content>
        </mat-card>

        <!-- Profile Completeness -->
        <mat-card class="profile-card">
          <mat-card-header>
            <mat-card-title>{{ tKeys.SF_ACCOUNT_OVERVIEW_PROFILE_COMPLETENESS_TITLE | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content class="profile-content">
            <div class="progress-section">
              <div class="progress-header">
                <span class="progress-label">Progress</span>
                <span class="progress-percentage">{{ profileCompleteness }}%</span>
              </div>
              <mat-progress-bar [value]="profileCompleteness" class="progress-bar"></mat-progress-bar>
            </div>
            <p class="profile-description">
              Complete your profile to unlock all features and get personalized recommendations.
            </p>
            <button mat-stroked-button routerLink="../personal-info" class="complete-profile-button">
              {{ tKeys.SF_ACCOUNT_OVERVIEW_COMPLETE_PROFILE_BUTTON | translate }}
            </button>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>

  <ng-template #noOverviewData>
    <div *ngIf="!isLoading" class="error-state">
      <p>{{ tKeys.SF_ACCOUNT_OVERVIEW_LOAD_ERROR | translate }}</p>
    </div>
  </ng-template>
</section>
