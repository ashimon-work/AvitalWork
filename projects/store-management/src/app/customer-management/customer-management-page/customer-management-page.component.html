<!-- Customer Management Page -->
<div class="customer-management-container">
  <h1>{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TITLE | translate }}</h1>

  <!-- Action Bar -->
  <div class="action-bar d-flex justify-content-between align-items-center mb-3">
    <div class="search-filter d-flex align-items-center">
      <input type="text" class="form-control me-2" [placeholder]="tKeys.SM_CUSTOMER_MGMT_PAGE_SEARCH_PLACEHOLDER | translate" [(ngModel)]="searchTerm" (input)="onSearchTermChange($event)">
      <select class="form-select me-2" [(ngModel)]="selectedFilter" (change)="onFilterChange($event)">
        <option value="">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_FILTER_ALL | translate }}</option>
        <option value="purchase-history">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_FILTER_PURCHASE_HISTORY | translate }}</option>
        <option value="signup-date">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_FILTER_SIGNUP_DATE | translate }}</option>
        <option value="status">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_FILTER_ACCOUNT_STATUS | translate }}</option>
      </select>
      <button class="btn btn-secondary me-2" (click)="exportCustomers()" [disabled]="isExporting">
        {{ (isExporting ? tKeys.SM_CUSTOMER_MGMT_PAGE_EXPORT_BUTTON_EXPORTING : tKeys.SM_CUSTOMER_MGMT_PAGE_EXPORT_BUTTON_EXPORT) | translate }}
      </button>
      <button class="btn btn-outline-secondary">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_SEGMENTATION_BUTTON | translate }}</button>
    </div>
  </div>

  <!-- Customers Table -->
  <div class="customers-table-container">
    <table class="table table-striped">
      <thead>
        <tr>
          <tr>
            <th (click)="sortCustomers('name')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_NAME | translate }} <span *ngIf="sortColumn === 'name'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('email')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_EMAIL | translate }} <span *ngIf="sortColumn === 'email'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('phone')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_PHONE | translate }} <span *ngIf="sortColumn === 'phone'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('location')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_LOCATION | translate }} <span *ngIf="sortColumn === 'location'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('ordersCount')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_ORDERS | translate }} <span *ngIf="sortColumn === 'ordersCount'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('totalSpent')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_TOTAL_SPENT | translate }} <span *ngIf="sortColumn === 'totalSpent'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('lastOrderDate')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_LAST_ORDER | translate }} <span *ngIf="sortColumn === 'lastOrderDate'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th (click)="sortCustomers('accountStatus')">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_STATUS | translate }} <span *ngIf="sortColumn === 'accountStatus'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span></th>
            <th>{{ tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_HEADER_ACTIONS | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <!-- Customer rows will be dynamically loaded -->
          <tr *ngFor="let customer of customers">
            <td>{{ customer.name }}</td> <!-- Assuming customer has name -->
            <td>{{ customer.email }}</td> <!-- Assuming customer has email -->
            <td>{{ customer.phone || (tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_DATA_NA | translate) }}</td> <!-- Assuming customer has phone -->
            <td>{{ customer.location || (tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_DATA_NA | translate) }}</td> <!-- Assuming customer has location -->
            <td>{{ customer.ordersCount || 0 }}</td> <!-- Assuming customer has ordersCount -->
            <td>{{ customer.totalSpent | currency }}</td> <!-- Assuming customer has totalSpent -->
            <td>{{ customer.lastOrderDate ? (customer.lastOrderDate | date: 'shortDate') : (tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_DATA_NA | translate) }}</td> <!-- Assuming customer has lastOrderDate -->
            <td>{{ customer.accountStatus || (tKeys.SM_CUSTOMER_MGMT_PAGE_TABLE_DATA_NA | translate) }}</td> <!-- Assuming customer has accountStatus -->
            <td>
              <button class="btn btn-sm btn-info me-1" (click)="openCustomerDetailsModal(customer)">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_ACTION_VIEW | translate }}</button>
              <button class="btn btn-sm btn-secondary me-1">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_ACTION_EDIT | translate }}</button>
              <button class="btn btn-sm btn-danger">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_ACTION_CONTACT | translate }}</button>
            </td>
          </tr>
          <!-- Rows will be dynamically generated by *ngFor -->
    </table>
  </div>

  <!-- Pagination Controls -->
  <div class="pagination-controls d-flex justify-content-between align-items-center mt-3">
    <div class="customers-count-summary">
      <p *ngIf="totalCustomers > 0">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_PAGINATION_SUMMARY | translate:{ start: (currentPage - 1) * pageSize + 1, end: currentPage * pageSize > totalCustomers ? totalCustomers : currentPage * pageSize, total: totalCustomers } }}</p>
    </div>
    <div>
      <button class="btn btn-secondary me-1" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_PAGINATION_PREVIOUS | translate }}</button>
      <span *ngIf="totalPages > 0">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_PAGINATION_PAGE_INFO | translate:{ currentPage: currentPage, totalPages: totalPages } }}</span>
      <button class="btn btn-secondary ms-1" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_PAGINATION_NEXT | translate }}</button>
    </div>
  </div>

  <!-- Customer Details Modal Placeholder -->
  <div class="modal fade" id="customerDetailsModal" tabindex="-1" aria-labelledby="customerDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="customerDetailsModalLabel">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_MODAL_TITLE | translate }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" [attr.aria-label]="tKeys.SM_CUSTOMER_MGMT_PAGE_MODAL_CLOSE_ARIA_LABEL | translate"></button>
        </div>
        <div class="modal-body">
          <!-- Customer details content will go here -->
          <p *ngIf="selectedCustomer">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_MODAL_SELECTED_CUSTOMER_DETAILS | translate: selectedCustomer?.name }}</p>
          <!-- Placeholder for actual customer details component or content -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_MODAL_CLOSE_BUTTON | translate }}</button>
          <button type="button" class="btn btn-primary">{{ tKeys.SM_CUSTOMER_MGMT_PAGE_MODAL_SAVE_BUTTON | translate }}</button>
        </div>
      </div>
    </div>
  </div>
</div>