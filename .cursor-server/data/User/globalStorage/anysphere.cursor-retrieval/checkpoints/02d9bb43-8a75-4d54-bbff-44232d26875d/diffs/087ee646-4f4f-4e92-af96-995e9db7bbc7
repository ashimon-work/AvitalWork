{"fsPath":"\\home\\racheli\\project\\backend\\api\\src\\products\\products.service.ts","fileUuid":"087ee646-4f4f-4e92-af96-995e9db7bbc7","fileSizeBytes":21949,"numLines":700,"diffChanges":[{"originalStartLineNumberOneIndexed":217,"originalEndLineNumberExclusiveOneIndexed":217,"modifiedStartLineNumberOneIndexed":217,"modifiedEndLineNumberExclusiveOneIndexed":288,"addedLines":["    // If category_id is provided, use query builder for ManyToMany relation filtering","    if (params.category_id) {","      const queryBuilder = this.productsRepository","        .createQueryBuilder('product')","        .leftJoinAndSelect('product.store', 'store')","        .leftJoinAndSelect('product.categories', 'categories')","        .where('product.isActive = :isActive', { isActive: true })","        .andWhere('categories.id = :categoryId', { categoryId: params.category_id });","","      if (params.storeSlug) {","        queryBuilder.andWhere('store.slug = :storeSlug', { storeSlug: params.storeSlug });","      }","","      if (params.isFeaturedInMarketplace) {","        queryBuilder.andWhere('product.isFeaturedInMarketplace = :isFeatured', {","          isFeatured: true,","        });","      }","","      if (params.q) {","        queryBuilder.andWhere('product.name ILIKE :search', {","          search: `%${params.q}%`,","        });","      }","","      if (params.inStockOnly) {","        queryBuilder.andWhere('product.stockLevel > :stockLevel', { stockLevel: 0 });","      }","","      if (params.price_min !== undefined && params.price_max !== undefined) {","        queryBuilder.andWhere('product.price BETWEEN :minPrice AND :maxPrice', {","          minPrice: params.price_min,","          maxPrice: params.price_max,","        });","      } else if (params.price_min !== undefined) {","        queryBuilder.andWhere('product.price >= :minPrice', {","          minPrice: params.price_min,","        });","      } else if (params.price_max !== undefined) {","        queryBuilder.andWhere('product.price <= :maxPrice', {","          maxPrice: params.price_max,","        });","      }","","      // Apply sorting","      switch (params.sort) {","        case 'price-asc':","          queryBuilder.orderBy('product.price', 'ASC');","          break;","        case 'price-desc':","          queryBuilder.orderBy('product.price', 'DESC');","          break;","        case 'name-asc':","          queryBuilder.orderBy('product.name', 'ASC');","          break;","        case 'newest':","          queryBuilder.orderBy('product.createdAt', 'DESC');","          break;","        default:","          queryBuilder.orderBy('product.name', 'ASC');","          break;","      }","","      // Apply pagination","      queryBuilder.take(limit).skip(skip);","","      const [results, total] = await queryBuilder.getManyAndCount();","      return { products: results, total };","    }","","    // For non-category filtering, use the simpler find approach"],"tokenizedAddedLines":[1000388,166,1000389,1000390,1000391,1000392,1000393,1000394,25,1000395,1000396,71,25,1000397,1000398,1000399,1000400,71,25,1000401,1000402,1000403,1000400,71,25,1000404,1000405,71,25,1000406,1000407,1000408,1000409,1000400,1000410,1000411,1000408,1000400,1000412,1000413,1000409,1000400,71,25,1000414,1000415,1000416,1000417,1000418,1000419,1000420,1000418,1000421,1000422,1000418,1000423,1000424,1000418,1000425,1000422,1000418,71,25,1000426,1000427,25,1000428,1000429,95,25,1000430]},{"originalStartLineNumberOneIndexed":241,"originalEndLineNumberExclusiveOneIndexed":246,"modifiedStartLineNumberOneIndexed":312,"modifiedEndLineNumberExclusiveOneIndexed":312}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}